{"version":3,"file":"home.js","sources":["../client/config.js","../client/home.js"],"sourcesContent":["export var Config = {\n  readingPublishLimit: 200, // ms\n  flightPublishLimit: 1000, // ms\n  trackingGraphTimePeriod: 8000, // ms - time to keep points in visible graph\n  gravityMagnitudeConstant: 10, // default gravity magnitude value from accelerometer\n  broadcastNewChannelName: 'broadcast:channel', /* replicated in app.rb */\n  debug: false /* Will output debugging info and send detailed flight metrics when true */\n};\n","import { Config } from './config';\n\n$(function() {\n  var $mobileSupported = $('.mobile-ready'),\n      $mobileNotSupported = $('.mobile-not-ready'),\n      $channelName = $(this).find('input[name=channel-name]');\n\n  var gn = new GyroNorm();\n  gn.init().then(function() {\n    if (gn.isAvailable(GyroNorm.DEVICE_ORIENTATION) || gn.isAvailable(GyroNorm.ACCELERATION_INCLUDING_GRAVITY)) {\n      $mobileSupported.show();\n      $mobileNotSupported.hide();\n    } else {\n      $mobileSupported.hide();\n      $mobileNotSupported.show();\n    }\n  });\n\n  $('form.track-flight').on('submit', function(event) {\n    if ($channelName.val().replace(/^\\s+|\\s+$/g,\"\").length === 0) {\n      event.preventDefault();\n      $(this).find('input[name=channel-name]').focus();\n      alert(\"Please enter a valid live Lob code from another device\");\n    }\n  });\n\n  var ably = new Ably.Realtime({ authUrl: '/token', environment: 'eu-west-1-a' }),\n      broadcastChannel = ably.channels.get(Config.broadcastNewChannelName),\n      $recentLobs = $('div.recent-lobs'),\n      $lobHistory = $('ul.lob-history'),\n      recentChannels = {}\n\n  function pruneAndPresentChannelData() {\n    var activeChannelMessages = [],\n        activeChannelIDs = {},\n        $channelList = $('<ul>');\n\n    for (var channel in recentChannels) {\n      activeChannelMessages.push(recentChannels[channel])\n    }\n\n    activeChannelMessages.\n      sort(function(a, b) { return b.timestamp - a.timestamp; }).\n      slice(0,14).\n      forEach(function(message) {\n        activeChannelIDs[message.data.channel] = true;\n        var link = $('<a>').text(message.data.channel).attr('href', '/track/' + message.data.channel);\n        $channelList.append($(\"<li>\").append(link));\n      });\n\n    for (var channel in recentChannels) {\n      if (!activeChannelIDs[channel]) {\n        delete recentChannels[channel];\n      }\n    }\n\n    if ($channelList.find('li').length) {\n      $lobHistory.find('li').remove();\n      $lobHistory.append($channelList.find('li'));\n      $recentLobs.show();\n    }\n  }\n\n  broadcastChannel.attach(function(err) {\n    if (err) {\n      console.error(\"Could not attach to broadcast channel\", err);\n      return;\n    }\n\n    broadcastChannel.subscribe(\"new\", function(message) {\n      recentChannels[message.data.channel] = message;\n      pruneAndPresentChannelData();\n    });\n\n    broadcastChannel.history(function(err, historyPage) {\n      if (err) {\n        console.warn(\"Could not retrieve broadcast history:\", err);\n        return;\n      }\n      historyPage.items.forEach(function(message) {\n        recentChannels[message.data.channel] = message;\n      });\n      pruneAndPresentChannelData();\n    });\n  });\n});\n"],"names":[],"mappings":"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"}